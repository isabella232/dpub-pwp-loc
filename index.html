<!DOCTYPE html>
<html>
<head>
    <title>PWP Locators</title>
    <meta charset='utf-8'>
    <link rel="stylesheet" type="text/css" href="extras.css" />
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" async="" class="remove"></script>
    <style type="text/css">
        code {
            font-size: 120%;
        }
    </style>
    <script class="remove">
        var respecConfig = {
            localBiblio: {},
            // These may become useful if the document gets a more 'official' status
            // postProcess : [ postProc ],
            doRdfa: "true",
            // specification status (e.g. WD, LCWD, WG-NOTE, etc.). If in doubt use ED.
            specStatus: "ED",
            // the specification's short name, as in http://www.w3.org/TR/short-name/
            shortName: "pwp-loc",
            // if your specification has a subtitle that goes below the main
            // formal title, define it here
            // subtitle   :  "White Paper",
            // if you wish the publication date to be other than the last modification, set this
            // publishDate:  "2015-06-30",
            // if the specification's copyright date is a range of years, specify
            // the start date here:
            copyrightStart: "2016",
            // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
            // and its maturity status
            // previousPublishDate: "2015-10-15",
            // previousMaturity: "FPWD",
            // if there a publicly available Editor's Draft, this is the link
            edDraftURI: "http://w3c.github.io/dpub-pwp-loc/",
            // if this is a LCWD, uncomment and set the end of its review period
            // lcEnd: "2009-08-05",
            // editors, add as many as you like
            // only "name" is required
            editors: [
                {
                    name: "Ben De Meester"
                    , mailto: "ben.demeester@ugent.be"
                    , company: "Ghent University - iMinds - Data Science Lab"
                    , url: "http://users.ugent.be/~bjdmeest/"
                    , extras: [{
                    name: "<img src='figures/orcid_logo.png' />",
                    href: "http://orcid.org/0000-0003-0248-0987",
                    class: "orcid"
                }]
                    , companyURL: "http://www.iminds.be/"
                },
                {
                    name: "Ivan Herman"
                    , mailto: "ivan@w3.org"
                    , company: "W3C"
                    , companyURL: "http://www.w3.org"
                    , url: "http://www.w3.org/People/Ivan/"
                    , extras: [{
                    name: "<img src='figures/orcid_logo.png' />",
                    href: "http://orcid.org/0000-0003-0782-2704",
                    class: "orcid"
                }]
                    , w3cid: "7382"
                },
                {
                    name: "Tzviya Siegman"
                    , mailto: "tsiegman@wiley.com"
                    , company: "John Wiley & Sons, Inc."
                    , companyURL: "http://www.wiley.com"
                    , w3cid: "65542"
                }
            ],
            // name of the WG
            wg: "Digital Publishing Interest Group",
            // URI of the public WG page
            wgURI: "http://www.w3.org/dpub/IG/",
            // name (without the @w3c.org) of the public mailing to which comments are due
            wgPublicList: "public-digipub-ig",
            issueBase: "https://github.com/w3c/dpub-pwp-loc/issues/",
            noRecTrack: "true",
            otherLinks: [
                {
                    key: "Repository",
                    data: [{
                        value: "Github Repository",
                        href: "https://github.com/w3c/dpub-pwp-loc"
                    }]
                },
                {
                    key: "Issues tracker",
                    data: [{
                        value: "Github Issue Tracker",
                        href: "https://github.com/w3c/dpub-pwp-loc/issues"
                    }]
                },
                {
                    key: "Changes",
                    data: [{
                        value: "Commit history",
                        href: "https://github.com/w3c/dpub-pwp-loc/commits/gh-pages"
                    }]
                }
            ],
            // alternateFormats: [],
            charterDisclosureURI: "http://www.w3.org/2004/01/pp-impl/64149/status",
            // URI of the patent status for this WG, for Rec-track documents
            // !!!! IMPORTANT !!!!
            // This is important for Rec-track documents, do not copy a patent URI from a random
            // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
            // Team Contact.
            wgPatentURI: "http://www.w3.org/2004/01/pp-impl/64149/status",
            // !!!! IMPORTANT !!!! MAKE THE ABOVE BLINK IN YOUR HEAD
        };
    </script>
</head>
<body>
<section id='abstract'>
    <p>
        This document discusses the following issue:
        as Portable Web Publications (<a>PWP</a>) <a href="http://w3c.github.io/dpub-pwp/#state_definition">can exist in different states</a>,
        it should be possible to locate a <a>PWP</a> or resource within a <a>PWP</a> using a transparent locator
        that doesn't need to know which state the <a>PWP</a> is in,
        thus keeping in line with the goal of the <a href="http://w3c.github.io/dpub-pwp/#introduction">PWP draft specification</a>.
    </p>
</section>

<section id='sotd'>
    <p>
        This is an early draft, expect this document to change much and often.
    </p>
</section>

<section>
    <h2>Definitions</h2>
    <ul>
        <li>
            A Portable Web Document (<dfn>PWP</dfn>) is defined in <a href="http://w3c.github.io/dpub-pwp/">following document</a>.
            The example <a>PWP</a> in this document is denoted <dfn>P</dfn>.
        </li>
        <li>A <dfn>reading system</dfn> has the responsibility of the rendering the contents of a <a>PWP</a>.</li>
        <li>
            A <dfn>PWP processor</dfn> is a piece of functionality
            that has the responsibility of interpreting a <a>PWP</a> and its different locators,
            to pass the correct requested resources to the <a>reading system</a>.
            All mapping to and from <a data-lt="canonical locator">canonical locators</a> to specific, non-canonical locators should be done by the <a>PWP Processor</a>.
        </li>
        <li>
            The <dfn>server</dfn> has the responsibility of serving the <a data-lt="PWP">PWP-s</a> in their different states.
            As such, the <a>server</a> always is aware of all possible published states of the <a>PWP</a>.
            This server will always need some kind of configuration or maybe more complex functionalities, but this is not defined by this document.
        </li>
        <li>
            A <dfn>locator</dfn> is a URL that points to either an entire PWP or a resource within a PWP.
        </li>
    </ul>
    <section class="note">
        <p>To be more exact, a locator is always a resource locator. This resource part is implied, but omitted for brevity.</p>
    </section>
    <ul>
        <li>
            A <dfn>PWP locator</dfn> is a <a>locator</a> to the PWP as a whole.
            This PWP is always in a certain state. Also called “State locator”.
            Throughout the document, we will use <dfn>Lu</dfn> as the PWP Locator of the published unpacked <a>P</a>,
            and <dfn>Lp</dfn> as the PWP Locator of the published packed <a>P</a>.
            This <a>PWP Locator</a> can be dereferenced via an HTTP request and should return some information.
            As such, it is not the same as an identifier, although, it <em>could</em> be the same.
        </li>
    </ul>
    <section class="note">
        <p>
            The various states of a <a>PWP</a>, that may have their distinct <a data-lt="PWP Locator">PWP locators</a>,
            contain exactly the same abstract content, and should be the same in terms of structure.
        </p>
        <p>
            There is no requirement that the publisher publishes all these states, it may choose to publish only one, i.e.,
            <a>Lu</a> and <a>Lp</a> don't have to both exist.
            There can be situations where the <a>PWP</a> is only published unpacked (so only <a>Lu</a> exists),
            or only published packed (so only <a>Lp</a> exists).
        </p>
        <p>
            Also, the packaging format of <a>Lp</a> is currently not defined, and is not required for this document.
        </p>
    </section>
    <ul>
        <li>A <dfn>relative locator</dfn> is a locator to a resource within a <a>PWP</a>, without specifying the location of the <a>PWP</a>.</li>
        <li>An <dfn>absolute locator</dfn> is a combination of a <a>PWP locator</a> and a <a>relative locator</a>.</li>
        <li><dfn>Canonical</dfn> is defined in the <a href="https://en.wiktionary.org/wiki/canonical">mathematical sense</a>:
            distinguished among entities of its kind,
            so that it can be picked out in a way
            that does not depend on any arbitrary choices.
        </li>
    </ul>
    <section class="note">
        <p>These arbitrary choices are, in our case, packed vs unpacked.
            Canonical absolute URL-s have the protocol built-in.
            See the <a href="http://w3c.github.io/dpub-pwp/">current WD</a>.</p>
    </section>
    <ul>
        <li>
            The <dfn>canonical locator</dfn> is an absolute and state independent locator.
            The <a>canonical locator</a> is constructed as if the <a>PWP</a> was published unpacked online.
            This is pure conceptual, i.e., the <a>PWP</a> does not have to be published unpacked online.
            Throughout the document, we will use <dfn>L</dfn> as the <a>canonical locator</a> of a published <a>PWP</a>.
        </li>
    </ul>
    <section class="note">
        <p>
            There is no requirement that <a>L</a> <em>must</em> be different from <a>Lu</a>.
        </p>
    </section>
    <ul>
        <li>
            The <dfn>manifest</dfn> is in this document all metadata of a <a>PWP</a>.
            This includes a list of all the spine items, <a>L</a>, <a>Lu</a>, and <a>Lp</a> (given both <a>Lu</a> and <a>Lp</a> exist).
            The <a>manifest</a> should be available in all different states of <a>P</a>.
        </li>
    </ul>
    <section class="note">
        <p>
            It must be emphasized that there is no requirement of having a one to one correspondence between the <a>manifest</a> as a conceptual entity and a specific file.
            Elements of the <a>manifest</a> may be combined from different sources
            (e.g., different manifest files, information conveyed through HTTP Responses, etc.),
        </p>
    </section>
</section>

<section id="problem">
    <h2>The Problem</h2>
    <p>
        <a>P</a> is published on the <a>server</a>.
        <a>P</a> includes the resource for an image of the Mona Lisa,
        and it is published in at least one of the different states:
    </p>
    <ul>
        <li>
            In an “unpacked” state, i.e., as a hierarchy of files on the server.
            The “top level” of this unpacked state is available through the URL <code>https://example.org/books/1/</code> (<a>Lu</a>):
            in this setup, the image of the Mona Lisa has the URL <code>https://example.org/books/1/img/mona_lisa.jpg</code>.
            This is the <a>absolute locator</a> of the image in this state.
        </li>
        <li>
            In a “packed” state, namely as part of a, say, zip file (but with a PWP-specific media type).
            This is available through the URL <code>https://example.org/packed-books/1/package.pwp</code>.
            This is the <a>absolute locator</a> of <a>P</a> in this state, namely <a>Lp</a>.
        </li>
    </ul>
    <section class="issue" data-number="4" title="Should the resources in a PWP follow a hierarchical &ldquo;tree like&rdquo; structure?">
    </section>
    <section class="note">
        <p>
            There may be other states, mostly similarly packed states but using a different archiving technology (e.g., <code>tar.gz</code>).
            Their treatments are similar; we will not consider them in what follows because it does not change the various considerations.
        </p>
    </section>
    <p>
        <a>P</a> is assigned a <a>canonical locator</a>, the URL <code>https://example.org/published-books/1</code> (<a>L</a>).
        Reflecting the unpacked state in terms of (file) structure the <a>canonical locator</a> of the Mona Lisa image is <code>https://example.org/published-books/1/img/mona_lisa.jpg</code>.
    </p>
    <section class="note">
        <p>
            As the example shows, the exact URL string may be structurally different from both <a>Lu</a> and <a>Lp</a>, i.e.,
            it is not necessarily a substring of one or the other).
            <a>L</a> <em>may</em> be identical to <a>Lu</a>, but not necessarily.
        </p>
    </section>
    <p>
        The translation, in practical terms, is that, whenever possible,
        the absolute locator <a>L</a> should be used when referring to <a>P</a> in, e.g., annotations.
        This is also true for URL-s derived from <a>L</a> like <code>https://example.org/published-books/1/img/mona_lisa.jpg</code>.
    </p>
</section>

<section id="pwp-processor">
    <h2>Functionalities of the <a>PWP processor</a></h2>

    <p>See <a href="#fig-flow-get-l"></a> for the flow chart of when a <a>PWP processor</a> requests <a>P</a> (thus does a HTTP GET request on <a>L</a>).</p>

    <section class="note">
        <p>
            If the <a>PWP processor</a> already has the cached publication,
            than that will probably prevail (modulo cache state) and there may be no HTTP request in the first place.
            This section really refers to the situation of a first access.
        </p>
    </section>

    <section class="issue" data-number="5" title="Do we have to specify what happens when the PWP processor already has a cached version?">
    </section>

    <figure id="fig-flow-get-l" class="overlarge">
        <img src="drafts/PWPClient3.svg" alt="Flowchart of what happens when a Portable Web Publication is retrieved by the user"/>
        <figcaption>Flowchart of what happens when a <a>PWP</a> is retrieved by the user. (The image is available in <a href="drafts/PWPClient3.svg">SVG</a> or <a href="drafts/PWPClient3.png">PNG</a> formats.)</figcaption>
    </figure>

        <p>
            Please note that the HTTP GET <a>L</a> takes into account both the top and bottom part of the flow chart in parallel, i.e.,
            there are multiple ways of trying to reconstruct the <a>manifest</a>.
            These options that the <a>server</a> may return include (but are not limited to):
        </p>

    <ul>
        <li>the entire <a>manifest</a> (serialized as a JSON file, RDFa+HTML file, etc.); or</li>
        <li>a package in some predefined PWP format that must include (a subset of) the <a>manifest</a>; or</li>
        <li>an HTML, SVG, or other resource, representing, e.g., the cover page of the publication, with (a subset of) the <a>manifest</a> provided through the Link header of the HTTP Response; or</li>
        <li>an (X)HTML file containing the <code>&lt;link&gt;</code> element referring to (a subset of) the <a>manifest</a></li>
    </ul>

    <section class="note">
        <p>It may be important to return, as part of the HTTP response, a distinctive media type for the serialization of the entire <a>manifest</a>.</p>
    </section>

    <section class="note">
        <p>
            These possibilities are not mutually exclusive.
            Each returned information, by itself, may be incomplete (hence the remark 'subset thereof')
            and a combination of those, or other possibilities
            may provide the complete <a>manifest</a>.
        </p>
    </section>

    <section class="issue" data-number="6" title="What is the relative priority of various manifests?">
    </section>
    <section class="issue" data-number="7" title="Do we have to be exhaustive in the various options on getting to manifests?">
    </section>

    <p>
        The full <a>manifest</a> is constructed using multiple options.
        In the end, the <a>manifest</a> should consists of all metadata to render <a>P</a>,
        but also all available <a data-lt="PWP locator">PWP locators</a> on the <a>server</a>.
    </p>

    <p>
        Once the full <a>manifest</a> is constructed, <a>P</a> can be retrieved, or a resource within <a>P</a> can be retrieved.
        Based on <a>L</a>, the <a>PWP processor</a> can derive a <a>relative locator</a> for the image, i.e., <code>img/mona_lisa.jpg</code>.
    </p>

    <p>
        Then, the <a>PWP processor</a> can access the image:
        </p>
    <ul>
        <li>
            If the preferred state is the packed one, then <a>Lp</a> is accessed, unpacked,
            and the image is localized within the unpacked content
            (and that usually means using the <a>relative locator</a> as some sort of a file system path within that unpacked content).
        </li>
        <li>
            If the preferred state is the unpacked one, then the locator of the image is constructed by using <a>Lu</a> and the <a>relative locator</a>,
            yielding <code>https://example.org/books/1/img/mona_lisa.jpg</code>.
        </li>
    </ul>

    <section class="issue" data-number="8" title="Preference of media type (a.k.a. content) of the PWP processor">
    </section>

    <section class="note">
        <p>
            There may be “smarter” <a data-lt="PWP processor">PWP Processors</a> that make use of local facilities like caching,
            but those do not modify these conceptual approaches.
        </p>
    </section>

</section>

<section id="resources">
    <h2>How to fetch a resource from within a <a>PWP</a></h2>

    <p>
        Given a situation where a <a>PWP</a> is only published packed, e.g., once zipped and once tarred,
        and a resource is requested, the question is how does this resource get to the end-user.
    </p>

    <section class="issue" data-number="9" title="How to fetch a resource from within a PWP?">
    </section>

</section>

<section id="local-pwp">
    <h2>Local (downloaded) PWPs</h2>

    <section class="issue" data-number="10" title="What to do with a locally downloaded PWP?">
    </section>

    <section class="issue" data-number="11" title="What to do with a PWP that is published nowhere, i.e., are created locally?">
    </section>
</section>

<section id="breadcrumbs">
    <h2>Breadcrumbs</h2>

    <section class="issue">
        <p>To be discussed.</p>
    </section>

    <p>When I download a <a>PWP</a>, and copy that <a>PWP</a> to a different location, than we still talk about the same <a>PWP</a>.</p>

    <p>However, when, e.g., a teacher adds annotations inside the <a>PWP</a>, he or she creates a new, altered <a>PWP</a>, i.e., <a data-lt="P">P'</a>.</p>

    <p>
        To keep the connections between <a>P</a> and <a data-lt="P">P'</a>,
        we can allow for a trail of breadcrumbs, to be persisted inside the <a>PWP</a>.
        E.g., <a>P</a> might contain <code>canonical: L, breadcrumbs: []</code>,
        as it is an unaltered version of the original <a>PWP</a>, published under <a>L</a>.
        <a data-lt="P">P'</a> however might be published at the school of the teacher,
        under <code>https://example.org/course/french/frenchbook</code> (<a data-lt="L">L'</a>),
        and contain <code>canonical: L', breadcrumbs: [L]</code>.
    </p>

    <p>
        A student may then again copy <a data-lt="P">P'</a> to his own web space,
        and makes annotations (<a data-lt="P">P''</a> under <code>https://example.org/student/1/frenchbook</code>, <a data-lt="L">L''</a>).
        <a data-lt="P">P''</a> may then contain <code>canonical: L'', breadcrumbs: [L, L']</code>
    </p>

    <p>
        References to <a data-lt="P">P'</a> or <a data-lt="P">P''</a> might thus
        be interpreted by a <a>PWP processor</a> to link back to the original <a>L</a>.
    </p>

</section>
</body>
</html>
